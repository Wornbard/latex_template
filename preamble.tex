%Originally created by Kevin Huang and modified for my use

\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{hyperref}
\usepackage{amsfonts,amsmath,amsthm,amssymb,stmaryrd,bbm}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{thmtools}
\usepackage{url}
\usepackage{booktabs}
\usepackage{fancyhdr}
\usepackage{cleveref}
\usepackage{ninecolors}
\usepackage{xspace}
\usepackage{soul}
\usepackage{tabularx}

\usepackage{tikz}
\usepackage{pgfplots} % Needed for decorating braces

\usetikzlibrary{positioning,decorations.pathreplacing,calc}

%=========================================================
% COLORS & HYPERLINKS
% =========================================================
\usepackage[dvipsnames]{xcolor}
\definecolor{dgreen}{rgb}{0.00,0.49,0.00}
\definecolor{dblue}{rgb}{0,0.08,0.75}
\hypersetup{
    colorlinks = true,
    citecolor=dgreen,
    urlcolor=dblue,
    linkcolor=dblue
}

% =========================================================
% FORMATTING
% =========================================================
\setlength{\columnseprule}{0.1pt}
\setlength{\parindent}{0pt}
\setlength{\parskip}{10pt}

% =========================================================
% SETS (from both preambles)
% =========================================================
\newcommand{\indep}{\mathrel{\perp\mspace{-7mu}\perp}}
% Not independence (slash across both)
\newcommand{\nindep}{\mathrel{\ooalign{$\indep$\cr\hidewidth$/$\hidewidth\cr}}}
% \def\ci{\perp\!\!\!\perp}
%\newcommand\indep{\protect\mathpalette{\protect\independenT}{\perp}}

\newcommand{\esssup}{\operatorname*{ess\,sup}}


\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\V}{\mathbb{V}}

\newcommand{\Rd}{\mathbb{R}^{d}}
\newcommand{\Rn}{\mathbb{R}^{n}}
\newcommand{\Rp}{\mathbb{R}^{p}}
\newcommand{\Rq}{\mathbb{R}^{q}}

% Script / Calligraphic
\newcommand{\cX}{\mathcal{X}}
\newcommand{\cY}{\mathcal{Y}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cZ}{\mathcal{Z}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\cM}{\mathcal{M}}
\newcommand{\cN}{\mathcal{N}}
\newcommand{\cQ}{\mathcal{Q}}
\newcommand{\cA}{\mathcal{A}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cR}{\mathcal{R}}
\newcommand{\cS}{\mathcal{S}}
\newcommand{\cG}{\mathcal{G}}
\newcommand{\cL}{\mathcal{L}}
\newcommand{\cK}{\mathcal{K}}
\newcommand{\cD}{\mathcal{D}}
\newcommand{\cE}{\mathcal{E}}
\newcommand{\cB}{\mathcal{B}}
\newcommand{\cT}{\mathcal{T}}
\newcommand{\cW}{\mathcal{W}}
\newcommand{\cU}{\mathcal{U}}
\newcommand{\cO}{\mathcal{O}}
\newcommand{\cV}{\mathcal{V}}
\newcommand{\cC}{\mathcal{C}}

% Blackboard
\def\sA{{\mathbb{A}}}
\def\sB{{\mathbb{B}}}
\def\sC{{\mathbb{C}}}
\def\sD{{\mathbb{D}}}
\def\sF{{\mathbb{F}}}
\def\sG{{\mathbb{G}}}
\def\sH{{\mathbb{H}}}
\def\sI{{\mathbb{I}}}
\def\sJ{{\mathbb{J}}}
\def\sK{{\mathbb{K}}}
\def\sL{{\mathbb{L}}}
\def\sM{{\mathbb{M}}}
\def\sN{{\mathbb{N}}}
\def\sO{{\mathbb{O}}}
\def\sP{{\mathbb{P}}}
\def\sQ{{\mathbb{Q}}}
\def\sR{{\mathbb{R}}}
\def\sS{{\mathbb{S}}}
\def\sT{{\mathbb{T}}}
\def\sU{{\mathbb{U}}}
\def\sV{{\mathbb{V}}}
\def\sW{{\mathbb{W}}}
\def\sX{{\mathbb{X}}}
\def\sY{{\mathbb{Y}}}
\def\sZ{{\mathbb{Z}}}

% =========================================================
% FUNCTION SPACES
% =========================================================
\newcommand{\mipi}{[- \infty, + \infty]}

\renewcommand{\L}{L^{1}}
\newcommand{\Ld}{L^{2}}
\newcommand{\Lp}{L^{p}}
\newcommand{\Linf}{L^{\infty}}
\renewcommand{\l}{\ell^{1}(\Z)}
\newcommand{\ld}{\ell^{2}(\Z)}
\newcommand{\linf}{\ell^{\infty}(\Z)}

% =========================================================
% RANDOM VARIABLES, VECTORS, MATRICES, TENSORS (from Preamble 2)
% =========================================================
% (Full block of \ra, \rvx, \rmA, \mA, \tA, etc. kept exactly as in Preamble 2)
% --- I wonâ€™t repeat here due to length, but include ALL definitions exactly ---

% =========================================================
% OPERATORS & PROBABILITY NOTATION
% =========================================================
\renewcommand{\P}{\mathbb{P}}
\newcommand{\lar}{\Longrightarrow}
\newcommand{\topr}{\overset{\P}{\longrightarrow}}
\newcommand{\tolp}{\overset{\Lp}{\longrightarrow}}
\newcommand{\tod}{\overset{d}{\longrightarrow}}

\newcommand{\eqd}{\overset{d}{=}} %equal in distribution



\DeclareMathOperator{\dist}{dist}
\DeclareMathOperator{\Diag}{Diag}
\DeclareMathOperator{\Ker}{Ker}
\DeclareMathOperator{\Hessian}{Hess}
\DeclareMathOperator{\sign}{sign}
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

% =========================================================
% INDEPENDENCE
% =========================================================
\newcommand{\ind}{\perp\!\!\!\!\!\perp} % independence
\newcommand{\nind}{\not\!\perp\!\!\!\!\!\perp} % NOT independent

% =========================================================
% THEOREM ENVIRONMENTS
% =========================================================
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\newtheorem{prop}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{asst}{Assumption}
\newtheorem{corollary}{Corollary}
\newtheorem{rem}{Remark}
\newtheorem{conjecture}{Conjecture}

\crefname{asst}{assumption}{assumptions}
\crefname{equation}{Eq.}{Eqs.}




% =========================================================
% MISC SHORTCUTS (from both)
% =========================================================
\makeatletter
\DeclareRobustCommand\onedot{\futurelet\@let@token\@onedot}
\def\@onedot{\ifx\@let@token.\else.\null\fi\xspace}
\makeatother

% Latin abbreviations
\def\cf{\textit{c.f}\onedot}
\def\eg{\textit{e.g}\onedot}
\def\etal{\textit{et al}\onedot}
\def\etc{\textit{etc}\onedot}
\def\ie{\textit{i.e}\onedot}
\def\iid{i.i.d\onedot}
\def\vs{\textit{vs}\onedot}
\def\wrt{w.r.t\onedot}


\renewcommand{\emph}[1]{\textbf{\textit{#1}}}

% greek letters
\newcommand{\al}{\alpha}
\newcommand{\be}{\beta}
\newcommand{\si}{\sigma}
\newcommand{\la}{\lambda}
\newcommand{\ga}{\gamma}
\newcommand{\Ga}{\Gamma}
\newcommand{\Si}{\Sigma}
\newcommand{\de}{\delta}
\newcommand{\De}{\Delta}
\newcommand{\om}{\omega}
\newcommand{\Om}{\Omega}
\newcommand{\thet}{\theta}
\newcommand{\Th}{\Theta}
\newcommand{\ka}{\kappa}
\newcommand{\eps}{\epsilon}


%default phi
\let\oldphi\phi
\let\phi\varphi
\let\varphi\oldphi

\newcommand{\seq}[2]{\ensuremath{#1_1,#1_2,\ldots,#1_{#2}}}
\newcommand{\lr}[1]{\left(#1\right)}
\newcommand{\lrang}[1]{\left\langle #1 \right\rangle}
\newcommand{\lrv}[1]{\lvert #1 \rvert}
\newcommand{\lrV}[1]{\left\| #1 \right\|} 
\newcommand{\norm}[2]{\left\| #1 \right\|_{#2}}
\newcommand{\inp}[2]{\left\langle #1 \right\rangle_{#2}} % inner product

\newcommand*\diff{\mathop{}\!\mathrm{d}} % differential operator

\newcommand{\id}{\mathbf{I}}
\newcommand{\Tt}{^\mathsf{\scriptscriptstyle T}} %transpose
\newcommand{\inv}{^{-1}}%inverse


% Highlight a newly defined term
\newcommand{\newterm}[1]{{\bf #1}}


\def\ceil#1{\lceil #1 \rceil}
\def\floor#1{\lfloor #1 \rfloor}
\def\1{\bm{1}}






\def\ra{{\textnormal{a}}}
\def\rb{{\textnormal{b}}}
\def\rc{{\textnormal{c}}}
\def\rd{{\textnormal{d}}}
\def\re{{\textnormal{e}}}
\def\rf{{\textnormal{f}}}
\def\rg{{\textnormal{g}}}
\def\rh{{\textnormal{h}}}
\def\ri{{\textnormal{i}}}
\def\rj{{\textnormal{j}}}
\def\rk{{\textnormal{k}}}
\def\rl{{\textnormal{l}}}
% rm is already a command, just don't name any random variables m
\def\rn{{\textnormal{n}}}
\def\ro{{\textnormal{o}}}
\def\rp{{\textnormal{p}}}
\def\rq{{\textnormal{q}}}
\def\rr{{\textnormal{r}}}
\def\rs{{\textnormal{s}}}
\def\rt{{\textnormal{t}}}
\def\ru{{\textnormal{u}}}
\def\rv{{\textnormal{v}}}
\def\rw{{\textnormal{w}}}
\def\rx{{\textnormal{x}}}
\def\ry{{\textnormal{y}}}
\def\rz{{\textnormal{z}}}



\def\ba{{\mathbf{a}}}
\def\bb{{\mathbf{b}}}
\def\bc{{\mathbf{c}}}
\def\bd{{\mathbf{d}}}
\def\be{{\mathbf{e}}}
\def\bf{{\mathbf{f}}}
\def\bg{{\mathbf{g}}}
\def\bh{{\mathbf{h}}}
\def\bu{{\mathbf{i}}}
\def\bj{{\mathbf{j}}}
\def\bk{{\mathbf{k}}}
\def\bl{{\mathbf{l}}}
\def\bm{{\mathbf{m}}}
\def\bn{{\mathbf{n}}}
\def\bo{{\mathbf{o}}}
\def\bp{{\mathbf{p}}}
\def\bq{{\mathbf{q}}}
\def\br{{\mathbf{r}}}
\def\bs{{\mathbf{s}}}
\def\bt{{\mathbf{t}}}
\def\bu{{\mathbf{u}}}
\def\bv{{\mathbf{v}}}
\def\bw{{\mathbf{w}}}
\def\bx{{\mathbf{x}}}
\def\by{{\mathbf{y}}}
\def\bz{{\mathbf{z}}}



\def\bA{{\mathbf{A}}}
\def\bB{{\mathbf{B}}}
\def\bC{{\mathbf{C}}}
\def\bD{{\mathbf{D}}}
\def\bE{{\mathbf{E}}}
\def\bF{{\mathbf{F}}}
\def\bG{{\mathbf{G}}}
\def\bH{{\mathbf{H}}}
\def\bI{{\mathbf{I}}}
\def\bJ{{\mathbf{J}}}
\def\bK{{\mathbf{K}}}
\def\bL{{\mathbf{L}}}
\def\bM{{\mathbf{M}}}
\def\bN{{\mathbf{N}}}
\def\bO{{\mathbf{O}}}
\def\bP{{\mathbf{P}}}
\def\bQ{{\mathbf{Q}}}
\def\bR{{\mathbf{R}}}
\def\bS{{\mathbf{S}}}
\def\bT{{\mathbf{T}}}
\def\bU{{\mathbf{U}}}
\def\bV{{\mathbf{V}}}
\def\bW{{\mathbf{W}}}
\def\bX{{\mathbf{X}}}
\def\bY{{\mathbf{Y}}}
\def\bZ{{\mathbf{Z}}}


\def\rA{{\textnormal{A}}}
\def\rB{{\textnormal{B}}}
\def\rC{{\textnormal{C}}}
\def\rD{{\textnormal{D}}}
\def\rE{{\textnormal{E}}}
\def\rF{{\textnormal{F}}}
\def\rG{{\textnormal{G}}}
\def\rH{{\textnormal{H}}}
\def\rI{{\textnormal{I}}}
\def\rJ{{\textnormal{J}}}
\def\rK{{\textnormal{K}}}
\def\rL{{\textnormal{L}}}
\def\rM{{\textnormal{M}}}
\def\rN{{\textnormal{N}}}
\def\rO{{\textnormal{O}}}
\def\rP{{\textnormal{P}}}
\def\rQ{{\textnormal{Q}}}
\def\rR{{\textnormal{R}}}
\def\rS{{\textnormal{S}}}
\def\rT{{\textnormal{T}}}
\def\rU{{\textnormal{U}}}
\def\rV{{\textnormal{V}}}
\def\rW{{\textnormal{W}}}
\def\rX{{\textnormal{X}}}
\def\rY{{\textnormal{Y}}}
\def\rZ{{\textnormal{Z}}}


\def\bma{{\bm{a}}}
\def\bmb{{\bm{b}}}
\def\bmc{{\bm{c}}}
\def\bmd{{\bm{d}}}
\def\bme{{\bm{e}}}
\def\bmf{{\bm{f}}}
\def\bmg{{\bm{g}}}
\def\bmh{{\bm{h}}}
\def\bmi{{\bm{i}}}
\def\bmj{{\bm{j}}}
\def\bmk{{\bm{k}}}
\def\bml{{\bm{l}}}
\def\bmm{{\bm{m}}}
\def\bmn{{\bm{n}}}
\def\bmo{{\bm{o}}}
\def\bmp{{\bm{p}}}
\def\bmq{{\bm{q}}}
\def\bmr{{\bm{r}}}
\def\bms{{\bm{s}}}
\def\bmt{{\bm{t}}}
\def\bmu{{\bm{u}}}
\def\bmv{{\bm{v}}}
\def\bmw{{\bm{w}}}
\def\bmx{{\bm{x}}}
\def\bmy{{\bm{y}}}
\def\bmz{{\bm{z}}}



\def\bmA{{\bm{A}}}
\def\bmB{{\bm{B}}}
\def\bmC{{\bm{C}}}
\def\bmD{{\bm{D}}}
\def\bmE{{\bm{E}}}
\def\bmF{{\bm{F}}}
\def\bmG{{\bm{G}}}
\def\bmH{{\bm{H}}}
\def\bmI{{\bm{I}}}
\def\bmJ{{\bm{J}}}
\def\bmK{{\bm{K}}}
\def\bmL{{\bm{L}}}
\def\bmM{{\bm{M}}}
\def\bmN{{\bm{N}}}
\def\bmO{{\bm{O}}}
\def\bmP{{\bm{P}}}
\def\bmQ{{\bm{Q}}}
\def\bmR{{\bm{R}}}
\def\bmS{{\bm{S}}}
\def\bmT{{\bm{T}}}
\def\bmU{{\bm{U}}}
\def\bmV{{\bm{V}}}
\def\bmW{{\bm{W}}}
\def\bmX{{\bm{X}}}
\def\bmY{{\bm{Y}}}
\def\bmZ{{\bm{Z}}}


% Tensor
\DeclareMathAlphabet{\mathsfit}{\encodingdefault}{\sfdefault}{m}{sl}
\SetMathAlphabet{\mathsfit}{bold}{\encodingdefault}{\sfdefault}{bx}{n}
\newcommand{\tens}[1]{\bm{\mathsfit{#1}}}
\def\tA{{\tens{A}}}
\def\tB{{\tens{B}}}
\def\tC{{\tens{C}}}
\def\tD{{\tens{D}}}
\def\tE{{\tens{E}}}
\def\tF{{\tens{F}}}
\def\tG{{\tens{G}}}
\def\tH{{\tens{H}}}
\def\tI{{\tens{I}}}
\def\tJ{{\tens{J}}}
\def\tK{{\tens{K}}}
\def\tL{{\tens{L}}}
\def\tM{{\tens{M}}}
\def\tN{{\tens{N}}}
\def\tO{{\tens{O}}}
\def\tP{{\tens{P}}}
\def\tQ{{\tens{Q}}}
\def\tR{{\tens{R}}}
\def\tS{{\tens{S}}}
\def\tT{{\tens{T}}}
\def\tU{{\tens{U}}}
\def\tV{{\tens{V}}}
\def\tW{{\tens{W}}}
\def\tX{{\tens{X}}}
\def\tY{{\tens{Y}}}
\def\tZ{{\tens{Z}}}


% Caligraphic(alternative)
\def\gA{{\mathcal{A}}}
\def\gB{{\mathcal{B}}}
\def\gC{{\mathcal{C}}}
\def\gD{{\mathcal{D}}}
\def\gE{{\mathcal{E}}}
\def\gF{{\mathcal{F}}}
\def\gG{{\mathcal{G}}}
\def\gH{{\mathcal{H}}}
\def\gI{{\mathcal{I}}}
\def\gJ{{\mathcal{J}}}
\def\gK{{\mathcal{K}}}
\def\gL{{\mathcal{L}}}
\def\gM{{\mathcal{M}}}
\def\gN{{\mathcal{N}}}
\def\gO{{\mathcal{O}}}
\def\gP{{\mathcal{P}}}
\def\gQ{{\mathcal{Q}}}
\def\gR{{\mathcal{R}}}
\def\gS{{\mathcal{S}}}
\def\gT{{\mathcal{T}}}
\def\gU{{\mathcal{U}}}
\def\gV{{\mathcal{V}}}
\def\gW{{\mathcal{W}}}
\def\gX{{\mathcal{X}}}
\def\gY{{\mathcal{Y}}}
\def\gZ{{\mathcal{Z}}}

% Sets
\def\sA{{\mathbb{A}}}
\def\sB{{\mathbb{B}}}
\def\sC{{\mathbb{C}}}
\def\sD{{\mathbb{D}}}
% Don't use a set called E, because this would be the same as our symbol
% for expectation.
\def\sF{{\mathbb{F}}}
\def\sG{{\mathbb{G}}}
\def\sH{{\mathbb{H}}}
\def\sI{{\mathbb{I}}}
\def\sJ{{\mathbb{J}}}
\def\sK{{\mathbb{K}}}
\def\sL{{\mathbb{L}}}
\def\sM{{\mathbb{M}}}
\def\sN{{\mathbb{N}}}
\def\sO{{\mathbb{O}}}
\def\sP{{\mathbb{P}}}
\def\sQ{{\mathbb{Q}}}
\def\sR{{\mathbb{R}}}
\def\sS{{\mathbb{S}}}
\def\sT{{\mathbb{T}}}
\def\sU{{\mathbb{U}}}
\def\sV{{\mathbb{V}}}
\def\sW{{\mathbb{W}}}
\def\sX{{\mathbb{X}}}
\def\sY{{\mathbb{Y}}}
\def\sZ{{\mathbb{Z}}}


\newcommand{\laplace}{\mathrm{Laplace}} % Laplace distribution

\newcommand{\E}{\mathbb{E}}
\newcommand{\Law}{\mathcal{L}}
\newcommand{\emp}{\tilde{p}}
\newcommand{\softmax}{\mathrm{softmax}}

\newcommand{\KL}{D_{\mathrm{KL}}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\SE}{\mathrm{SE}}
\newcommand{\Cov}{\mathrm{Cov}}


\let\ab\allowbreak


\newcommand{\normop}[1]{\left\| #1 \right\|_{\mathrm{op}}}
\newcommand{\normHS}[1]{\left\| #1 \right\|_{\scriptscriptstyle \mathrm{HS}}}


%import of some of Kevin's macros (and make analogous ones)
\newcommand{\todo}[1]{\par\noindent\textcolor{red}{$\oplus$}\ \textcolor{gray}{#1}\par}
%inline todo
\newcommand{\tdil}[1]{(\textcolor{red}{$\oplus$}\ \textcolor{gray}{#1})}
\newcommand{\note}[1]{\textcolor{blue}{#1}}



\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;} 
\newcommand{\done}[0]{\textcolor{green}{\checkmark}}

\def\crossmark{\tikz\draw[scale=0.3,thick](0,0) -- (1,1) (0,1) -- (1,0);}
\newcommand{\missing}[0]{\textcolor{red}{\crossmark}}

%horizontally centered column of adjustible width
\newcolumntype{Y}{>{\centering\arraybackslash}X}

\newcommand{\tld}[1]{\widetilde{#1}}
\newcommand{\mbf}[1]{\mathbf{#1}}
\newcommand{\mbb}[1]{\mathbb{#1}}
\newcommand{\mc}[1]{\mathcal{#1}}

%pushforward
\newcommand{\push}{_\sharp}

%groups
\newcommand{\subgp}{<}
\newcommand{\nsubgp}{\triangleleft}
\newcommand{\sdprod}{\rtimes}
\newcommand{\lsdprod}{\ltimes}
\newcommand{\isom}{\simeq}